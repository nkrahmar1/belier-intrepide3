<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de T√©l√©chargement Direct</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">üîΩ Test de T√©l√©chargement Direct</h1>
        
        <div class="row">
            <div class="col-md-8 mx-auto">
                
                <?php
                session_start();
                require_once 'vendor/autoload.php';
                $app = require_once 'bootstrap/app.php';
                $app->make('Illuminate\Contracts\Console\Kernel')->bootstrap();
                
                use App\Models\Article;
                use Illuminate\Support\Facades\Storage;
                
                echo "<div class='alert alert-info'>";
                echo "<h3>üìä Articles avec Documents</h3>";
                
                $articles = Article::whereNotNull('document_path')->get();
                
                foreach ($articles as $article) {
                    $exists = Storage::exists($article->document_path) ? "‚úÖ" : "‚ùå";
                    $size = Storage::exists($article->document_path) ? Storage::size($article->document_path) . " bytes" : "N/A";
                    
                    echo "<div class='card mb-3'>";
                    echo "<div class='card-body'>";
                    echo "<h5>$exists {$article->titre}</h5>";
                    echo "<p><strong>Document:</strong> {$article->document_path}</p>";
                    echo "<p><strong>Taille:</strong> $size</p>";
                    
                    if (Storage::exists($article->document_path)) {
                        echo "<a href='/articles/{$article->id}/download' class='btn btn-success' target='_blank'>";
                        echo "<i class='fas fa-download'></i> Tester le t√©l√©chargement";
                        echo "</a>";
                    } else {
                        echo "<span class='btn btn-danger disabled'>Document manquant</span>";
                    }
                    
                    echo "</div>";
                    echo "</div>";
                }
                
                echo "</div>";
                ?>
                
                <div class="alert alert-warning">
                    <h3>‚ö†Ô∏è Important</h3>
                    <ul>
                        <li><strong>Connectez-vous d'abord</strong> avant de tester les t√©l√©chargements</li>
                        <li><strong>Admin:</strong> aboulayebamba321@gmail.com (acc√®s direct)</li>
                        <li><strong>Utilisateur:</strong> user@test.com / password123 (avec abonnement)</li>
                    </ul>
                </div>
                
                <div class="alert alert-success">
                    <h3>‚úÖ Comment √ßa marche</h3>
                    <ol>
                        <li>Le syst√®me lit le <code>document_path</code> de l'article</li>
                        <li>Il v√©rifie que le fichier existe avec <code>Storage::exists()</code></li>
                        <li>Il utilise <code>Storage::download()</code> pour t√©l√©charger</li>
                        <li>Le fichier se t√©l√©charge automatiquement avec le bon nom</li>
                    </ol>
                </div>
                
                <div class="text-center mt-4">
                    <a href="/" class="btn btn-primary">üè† Retour √† l'accueil</a>
                    <a href="/login" class="btn btn-success">üîê Se connecter</a>
                    <a href="/category/Political" class="btn btn-info">üìÑ Voir les articles</a>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
