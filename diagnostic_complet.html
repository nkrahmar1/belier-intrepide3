<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnostic Navbar - B√©lier Intr√©pide</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        .diagnostic-panel {
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
        }
        .test-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .success { border-left: 4px solid #28a745; }
        .warning { border-left: 4px solid #ffc107; }
        .error { border-left: 4px solid #dc3545; }
        .info { border-left: 4px solid #17a2b8; }

        .navbar-test {
            background-color: #04672a !important;
            margin-bottom: 20px;
        }
        .navbar-test .navbar-brand,
        .navbar-test .nav-link {
            color: #fff !important;
        }
        .cart-icon {
            color: #fff;
            font-size: 1.5rem;
            text-decoration: none;
        }
        .cart-badge {
            background-color: #dc3545;
            color: white;
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 50%;
            margin-left: 5px;
        }
    </style>
</head>
<body>

<div class="container diagnostic-panel">
    <h1 class="text-center mb-4">üîç Diagnostic Navbar & Authentification</h1>

    <!-- Test de la navbar -->
    <div class="test-section info">
        <h3><i class="bi bi-ui-checks"></i> Test de la Navbar</h3>
        <nav class="navbar navbar-expand-lg navbar-test">
            <div class="container">
                <a class="navbar-brand" href="#">B√©lier-Intr√©pide</a>

                <div class="d-flex align-items-center">
                    <!-- Test utilisateur connect√© -->
                    <span class="navbar-text me-2 text-warning fw-bold">AK</span>
                    <div class="btn-group me-3">
                        <button type="button" class="btn btn-light dropdown-toggle" data-bs-toggle="dropdown">
                            Account
                        </button>
                        <ul class="dropdown-menu">
                            <li>
                                <button class="dropdown-item" onclick="testLogout()">
                                    <i class="bi bi-box-arrow-right"></i> Se d√©connecter
                                </button>
                            </li>
                        </ul>
                    </div>

                    <!-- Test panier -->
                    <div class="dropdown">
                        <a href="#" class="cart-icon dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="bi bi-cart3"></i>
                            <span class="cart-badge">3</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li class="p-3">
                                <div>
                                    <div class="fw-bold">
                                        <i class="bi bi-download text-success"></i> Article t√©l√©charg√©
                                    </div>
                                    <small class="text-muted">T√©l√©charg√© 1 fois</small>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>
        <div class="alert alert-info">
            üëÜ Testez les boutons ci-dessus pour v√©rifier les interactions
        </div>
    </div>

    <!-- V√©rifications techniques -->
    <div class="test-section success">
        <h3><i class="bi bi-gear"></i> V√©rifications techniques</h3>
        <div id="technical-checks">
            <div class="d-flex justify-content-between">
                <span>Bootstrap CSS charg√© :</span>
                <span id="bootstrap-css-status">‚è≥ Test...</span>
            </div>
            <div class="d-flex justify-content-between">
                <span>Bootstrap JS charg√© :</span>
                <span id="bootstrap-js-status">‚è≥ Test...</span>
            </div>
            <div class="d-flex justify-content-between">
                <span>Dropdowns fonctionnels :</span>
                <span id="dropdown-status">‚è≥ Test...</span>
            </div>
            <div class="d-flex justify-content-between">
                <span>√âtat authentification :</span>
                <span id="auth-status">‚è≥ Test...</span>
            </div>
        </div>
    </div>

    <!-- Tests manuels -->
    <div class="test-section warning">
        <h3><i class="bi bi-hand-index"></i> Tests manuels requis</h3>
        <div class="row">
            <div class="col-md-6">
                <h5>üéØ Sur votre site principal :</h5>
                <ol>
                    <li>Actualiser http://127.0.0.1:8003</li>
                    <li>V√©rifier que la navbar est visible en haut</li>
                    <li>Cliquer sur "Account" ‚Üí dropdown doit s'ouvrir</li>
                    <li>Cliquer sur "Se d√©connecter" ‚Üí confirmation + redirection</li>
                    <li>V√©rifier l'ic√¥ne panier avec badge</li>
                </ol>
            </div>
            <div class="col-md-6">
                <h5>üîß Si probl√®mes persistent :</h5>
                <ul>
                    <li>Vider le cache navigateur (Ctrl+F5)</li>
                    <li>V√©rifier la console (F12) pour erreurs JS</li>
                    <li>Tester avec un autre navigateur</li>
                    <li>V√©rifier que vous √™tes bien connect√©</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Actions rapides -->
    <div class="test-section info">
        <h3><i class="bi bi-lightning"></i> Actions rapides</h3>
        <div class="d-flex gap-2 flex-wrap">
            <button class="btn btn-primary" onclick="window.open('http://127.0.0.1:8003', '_blank')">
                üåê Ouvrir le site
            </button>
            <button class="btn btn-warning" onclick="window.open('http://127.0.0.1:8003/login', '_blank')">
                üîê Page de connexion
            </button>
            <button class="btn btn-info" onclick="window.open('http://127.0.0.1:8003/api/auth-status', '_blank')">
                üìä √âtat d'authentification
            </button>
            <button class="btn btn-success" onclick="testDropdowns()">
                üß™ Tester dropdowns
            </button>
        </div>
    </div>

    <!-- Informations de connexion -->
    <div class="test-section success">
        <h3><i class="bi bi-person-check"></i> Informations de test</h3>
        <div class="row">
            <div class="col-md-6">
                <strong>Utilisateur de test :</strong><br>
                Email : aimee.krah@test.com<br>
                Mot de passe : password123<br>
                Nom : Aim√©e Krah<br>
                Initiales : AK
            </div>
            <div class="col-md-6">
                <strong>Fonctionnalit√©s √† tester :</strong><br>
                ‚úÖ Connexion/D√©connexion<br>
                ‚úÖ Dropdown Account<br>
                ‚úÖ Dropdown Panier<br>
                ‚úÖ Affichage des initiales
            </div>
        </div>
    </div>

    <!-- R√©sultats des tests -->
    <div class="test-section" id="test-results" style="display: none;">
        <h3><i class="bi bi-clipboard-check"></i> R√©sultats des tests</h3>
        <div id="results-content"></div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Test Bootstrap CSS
    const testEl = document.createElement('div');
    testEl.className = 'container';
    document.body.appendChild(testEl);
    const computedStyle = getComputedStyle(testEl);
    const hasBootstrapCSS = computedStyle.width !== '100%';
    document.body.removeChild(testEl);

    document.getElementById('bootstrap-css-status').innerHTML =
        hasBootstrapCSS ? '‚úÖ Charg√©' : '‚ùå Non charg√©';

    // Test Bootstrap JS
    const hasBootstrapJS = typeof bootstrap !== 'undefined';
    document.getElementById('bootstrap-js-status').innerHTML =
        hasBootstrapJS ? '‚úÖ Charg√©' : '‚ùå Non charg√©';

    // Test dropdowns
    try {
        const dropdown = new bootstrap.Dropdown(document.querySelector('[data-bs-toggle="dropdown"]'));
        document.getElementById('dropdown-status').innerHTML = '‚úÖ Fonctionnels';
    } catch (e) {
        document.getElementById('dropdown-status').innerHTML = '‚ùå Erreur: ' + e.message;
    }

    // Test √©tat auth
    fetch('http://127.0.0.1:8003/api/auth-status')
        .then(response => response.json())
        .then(data => {
            const status = data.authenticated
                ? `‚úÖ Connect√© (${data.user?.name || 'Utilisateur'})`
                : '‚ùå Non connect√©';
            document.getElementById('auth-status').innerHTML = status;
        })
        .catch(() => {
            document.getElementById('auth-status').innerHTML = '‚ö†Ô∏è Impossible de v√©rifier';
        });
});

function testLogout() {
    alert('üß™ Test de d√©connexion !\nCeci devrait normalement vous d√©connecter.');
}

function testDropdowns() {
    const dropdowns = document.querySelectorAll('[data-bs-toggle="dropdown"]');
    let working = 0;

    dropdowns.forEach(dropdown => {
        try {
            const instance = new bootstrap.Dropdown(dropdown);
            instance.toggle();
            setTimeout(() => instance.hide(), 1000);
            working++;
        } catch (e) {
            console.error('Erreur dropdown:', e);
        }
    });

    const results = document.getElementById('test-results');
    const content = document.getElementById('results-content');
    content.innerHTML = `
        <div class="alert alert-${working > 0 ? 'success' : 'danger'}">
            ${working > 0 ? '‚úÖ' : '‚ùå'} ${working}/${dropdowns.length} dropdowns fonctionnels
        </div>
    `;
    results.style.display = 'block';
}
</script>

</body>
</html>
